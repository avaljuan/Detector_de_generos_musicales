---
title: "Clasificador_generos"
author: "Axel Valton"
date: "2026-01-05"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
#Obtenemos los nombres de los archivos de features
```{r}
features <- list.files(path=".")[grepl(pattern="features.*",x=list.files(path="."))]
```

#Cargamos y creamos el dataframe

```{r}
library(readr)
features_music <- NULL
for (nombre in features){
  features_genero <-  read_csv(nombre)
  features_music <- rbind(features_music, features_genero)
}


View(features_music)
```
#Convertimos a factor la columna Genero
```{r}
features_music$Genero <- as.factor(features_music$Genero)
```

#Creamos la partición en train-test

```{r}
library(caret)
pacman::p_load(randomForest)
set.seed(123) # Para que los resultados sean reproducibles

# Creamos los índices para el 70% de entrenamiento
trainIndex <- createDataPartition(features_music$Genero, p = 0.7, list = FALSE)

train_data <- features_music[trainIndex, ]
test_data  <- features_music[-trainIndex, ]
```

# Entrenamos con balanceo de clases

```{r}
# Buscamos cuántas muestras tiene el género con menos canciones
n_min <- min(table(train_data$Genero))

# Entrenar el Random Forest con Balanceo
rf_model <- randomForest(
  Genero ~ ., 
  data = train_data, 
  ntree = 500,           # Número de árboles
  importance = TRUE,     # Para ver qué variables son más importantes
  sampsize = rep(n_min, length(levels(train_data$Genero))), # BALANCEO AQUÍ
  strata = train_data$Genero
)

print(rf_model)
```
#Predecimos y generamos la matriz de confusión
```{r}
# Predecir en el set de prueba
predicciones <- predict(rf_model, test_data)

# Matriz de Confusión (ver aciertos y errores)
mc <- confusionMatrix(predicciones, test_data$Genero)
print(mc)
```




